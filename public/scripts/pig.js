(function(a){"use strict";function b(a,b,c){var d="#"+a+" {  position: relative;}."+b+"-figure {  background-color: #D5D5D5;  overflow: hidden;  left: 0;  position: absolute;  top: 0;  margin: 0;}."+b+"-figure img {  left: 0;  position: absolute;  top: 0;  height: 100%;  width: 100%;  opacity: 0;  transition: "+c/1e3+"s ease opacity;  -webkit-transition: "+c/1e3+"s ease opacity;}."+b+"-figure img."+b+"-thumbnail {  -webkit-filter: blur(30px);  filter: blur(30px);  left: auto;  position: relative;  width: auto;}."+b+"-figure img."+b+"-loaded {  opacity: 1;}",e=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",f.styleSheet?f.styleSheet.cssText=d:f.appendChild(document.createTextNode(d)),e.appendChild(f)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function d(a){var b=0;do isNaN(a.offsetTop)||(b+=a.offsetTop),a=a.offsetParent;while(a);return b}function e(a,d){return this.inRAF=!1,this.isTransitioning=!1,this.minAspectRatioRequiresTransition=!1,this.minAspectRatio=null,this.latestYOffset=0,this.lastWindowWidth=window.innerWidth,this.scrollDirection="down",this.visibleImages=[],this.settings={containerId:"pig",scroller:window,classPrefix:"pig",figureTagName:"figure",spaceBetweenImages:8,transitionSpeed:500,primaryImageBufferHeight:1e3,secondaryImageBufferHeight:300,thumbnailSize:20,urlForSize:function(a,b){return"/img/"+b+"/"+a},getMinAspectRatio:function(a){return 640>=a?2:1280>=a?4:1920>=a?5:6},getImageSize:function(a){return 640>=a?100:1920>=a?250:500}},c(this.settings,d||{}),this.container=document.getElementById(this.settings.containerId),this.container||void 0,this.scroller=this.settings.scroller,this.images=this._parseImageData(a),b(this.settings.containerId,this.settings.classPrefix,this.settings.transitionSpeed),this}function f(a,b,c){return this.existsOnPage=!1,this.aspectRatio=a.aspectRatio,this.filename=a.filename,this.index=b,this.pig=c,this.classNames={figure:c.settings.classPrefix+"-figure",thumbnail:c.settings.classPrefix+"-thumbnail",loaded:c.settings.classPrefix+"-loaded"},this}var g=function(){function a(){d||(d=!0,window.requestAnimationFrame?window.requestAnimationFrame(b):setTimeout(b,66))}function b(){c.forEach(function(a){a()}),d=!1}var c=[],d=!1;return{add:function(b){c.length||window.addEventListener("resize",a),c.push(b)},disable:function(){window.removeEventListener("resize",a)},reEnable:function(){window.addEventListener("resize",a)}}}();e.prototype._getTransitionTimeout=function(){return this.settings.transitionSpeed*1.5},e.prototype._getTransitionString=function(){return this.isTransitioning?this.settings.transitionSpeed/1e3+"s transform ease":"none"},e.prototype._recomputeMinAspectRatio=function(){var a=this.minAspectRatio;this.minAspectRatio=this.settings.getMinAspectRatio(this.lastWindowWidth),this.minAspectRatioRequiresTransition=!(null===a||a===this.minAspectRatio)},e.prototype._parseImageData=function(a){var b=[];return a.forEach(function(a,c){var d=new f(a,c,this);b.push(d)}.bind(this)),b},e.prototype._computeLayout=function(){var a=parseInt(this.container.clientWidth),b=[],c=0,d=0,e=0;this._recomputeMinAspectRatio(),!this.isTransitioning&&this.minAspectRatioRequiresTransition&&(this.isTransitioning=!0,setTimeout(function(){this.isTransitioning=!1},this._getTransitionTimeout()));var f=this._getTransitionString();[].forEach.call(this.images,function(g,h){var i=Math.max;if(e+=parseFloat(g.aspectRatio),b.push(g),e>=this.minAspectRatio||h+1===this.images.length){e=i(e,this.minAspectRatio);var j=a-this.settings.spaceBetweenImages*(b.length-1),k=j/e;b.forEach(function(a){var b=k*a.aspectRatio;a.style={width:parseInt(b),height:parseInt(k),translateX:c,translateY:d,transition:f},c+=b+this.settings.spaceBetweenImages}.bind(this)),b=[],e=0,d+=parseInt(k)+this.settings.spaceBetweenImages,c=0}}.bind(this)),this.totalHeight=d-this.settings.spaceBetweenImages},e.prototype._doLayout=function(){this.container.style.height=this.totalHeight+"px";var a="up"===this.scrollDirection?this.settings.primaryImageBufferHeight:this.settings.secondaryImageBufferHeight,b="down"===this.scrollDirection?this.settings.secondaryImageBufferHeight:this.settings.primaryImageBufferHeight,c=d(this.container),e=this.scroller===window?window.innerHeight:this.scroller.offsetHeight,f=this.latestYOffset-c-a,g=this.latestYOffset-c+e+b;this.images.forEach(function(a){a.style.translateY+a.style.height<f||a.style.translateY>g?a.hide():a.load()}.bind(this))},e.prototype._getOnScroll=function(){var a=this;return function(){var b=a.scroller===window?window.pageYOffset:a.scroller.scrollTop;a.previousYOffset=a.latestYOffset||b,a.latestYOffset=b,a.scrollDirection=a.latestYOffset>a.previousYOffset?"down":"up",a.inRAF||(a.inRAF=!0,window.requestAnimationFrame(function(){a._doLayout(),a.inRAF=!1}))}},e.prototype.enable=function(){return this.onScroll=this._getOnScroll(),this.scroller.addEventListener("scroll",this.onScroll),this.onScroll(),this._computeLayout(),this._doLayout(),g.add(function(){this.lastWindowWidth=this.scroller===window?window.innerWidth:this.scroller.offsetWidth,this._computeLayout(),this._doLayout()}.bind(this)),this},e.prototype.disable=function(){return this.scroller.removeEventListener("scroll",this.onScroll),g.disable(),this},f.prototype.load=function(){this.existsOnPage=!0,this._updateStyles(),this.pig.container.appendChild(this.getElement()),setTimeout(function(){this.existsOnPage&&(!this.thumbnail&&(this.thumbnail=new Image,this.thumbnail.src=this.pig.settings.urlForSize(this.filename,this.pig.settings.thumbnailSize),this.thumbnail.className=this.classNames.thumbnail,this.thumbnail.onload=function(){this.thumbnail&&(this.thumbnail.className+=" "+this.classNames.loaded)}.bind(this),this.getElement().appendChild(this.thumbnail)),!this.fullImage&&(this.fullImage=new Image,this.fullImage.src=this.pig.settings.urlForSize(this.filename,this.pig.settings.getImageSize(this.pig.lastWindowWidth)),this.fullImage.onload=function(){this.fullImage&&(this.fullImage.className+=" "+this.classNames.loaded)}.bind(this),this.getElement().appendChild(this.fullImage)))}.bind(this),100)},f.prototype.hide=function(){this.getElement()&&(this.thumbnail&&(this.thumbnail.src="",this.getElement().removeChild(this.thumbnail),delete this.thumbnail),this.fullImage&&(this.fullImage.src="",this.getElement().removeChild(this.fullImage),delete this.fullImage)),this.existsOnPage&&this.pig.container.removeChild(this.getElement()),this.existsOnPage=!1},f.prototype.getElement=function(){return this.element||(this.element=document.createElement(this.pig.settings.figureTagName),this.element.className=this.classNames.figure,this._updateStyles()),this.element},f.prototype._updateStyles=function(){this.getElement().style.transition=this.style.transition,this.getElement().style.width=this.style.width+"px",this.getElement().style.height=this.style.height+"px",this.getElement().style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.Pig=e})("undefined"==typeof window?this:window);